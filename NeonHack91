-- ═══════════════════════════════════════════════════════════════
--     DEATH BALL GUI v9.9 — ИСПРАВЛЕННЫЙ + УЛУЧШЕННЫЙ 2025
--                   by ЗЛАЯ ТАРЕЛКА + GROK (FIXED)
-- ═══════════════════════════════════════════════════════════════

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
local Window = Rayfield:CreateWindow({
   Name = "Death Ball GUI v9.9 — FIXED 2025",
   LoadingTitle = "ФИКСИМ ВСЁ...",
   LoadingSubtitle = "by Злая Тарелка + Grok",
   ConfigurationSaving = {Enabled = true, FolderName = "DeathBallFixed"}
})

local FarmTab = Window:CreateTab("FARM", nil)
local CombatTab = Window:CreateTab("COMBAT", nil)
local VisualsTab = Window:CreateTab("VISUALS", nil)
local MiscTab = Window:CreateTab("MISC", nil)

-- === ГЛОБАЛЬНЫЕ ПЕРЕМЕННЫЕ ===
getgenv().AutoFarm = false
getgenv().AutoParry = false
getgenv().AutoSpam = false
getgenv().BallESP = false
getgenv().PlayerESP = false
getgenv().SpeedHack = false
getgenv().WalkSpeed = 100
getgenv().InfiniteJump = false
getgenv().NoClip = false
getgenv().AutoClaimQuest = false
getgenv().AutoAbility = false
getgenv().AutoWalk = false
getgenv().ParryDistance = 20
getgenv().PingCompensation = 0.12

local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local LocalPlayer = Players.LocalPlayer
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local Humanoid = Character:WaitForChild("Humanoid")
local Root = Character:WaitForChild("HumanoidRootPart")

-- === ПРАВИЛЬНЫЕ REMOTE (2025) ===
local ParryRemote = ReplicatedStorage:WaitForChild("Events"):WaitForChild("ParryBall")
local ThrowRemote = ReplicatedStorage:WaitForChild("Events"):WaitForChild("ThrowBall")
local AbilityRemote = ReplicatedStorage:WaitForChild("Events"):WaitForChild("UseAbility")
local ClaimRemote = ReplicatedStorage:WaitForChild("Events"):WaitForChild("ClaimReward")

-- === НАХОЖДЕНИЕ ШАРА (2025) ===
local function GetBall()
    return Workspace:FindFirstChild("DeathBall") or Workspace:FindFirstChild("Ball")
end

-- === AUTO PARRY (УЛУЧШЕННЫЙ) ===
spawn(function()
    while task.wait(0.01) do
        if getgenv().AutoParry and GetBall() then
            local ball = GetBall()
            local dist = (ball.Position - Root.Position).Magnitude
            local velocity = ball.Velocity
            local direction = (Root.Position - ball.Position).Unit
            local dot = velocity:Dot(direction)
            local predicted = dist - (velocity.Magnitude * getgenv().PingCompensation)

            if predicted < getgenv().ParryDistance and dot > 0 then
                pcall(function()
                    ParryRemote:FireServer(ball)
                end)
                task.wait(0.05 + math.random(1,3)/100) -- Анти-бан
            end
        end
    end
end)

-- === AUTO FARM + AUTO SPAM ===
spawn(function()
    while task.wait(0.1) do
        if (getgenv().AutoFarm or getgenv().AutoSpam) and GetBall() then
            local ball = GetBall()
            pcall(function()
                ThrowRemote:FireServer(ball)
            end)
        end
    end
end)

-- === AUTO WALK (К ШАРУ) ===
spawn(function()
    while task.wait(0.1) do
        if getgenv().AutoWalk and GetBall() then
            local ball = GetBall()
            Humanoid:MoveTo(ball.Position)
        end
    end
end)

-- === AUTO ABILITY + CLAIM ===
spawn(function()
    while task.wait(1) do
        if getgenv().AutoAbility then
            pcall(function() AbilityRemote:FireServer() end)
        end
        if getgenv().AutoClaimQuest then
            pcall(function() ClaimRemote:FireServer() end)
        end
    end
end)

-- === BALL ESP (Highlight + Text) ===
local BallHighlight = nil
local BallBillboard = nil
RunService.RenderStepped:Connect(function()
    local ball = GetBall()
    if getgenv().BallESP and ball then
        if not BallHighlight then
            BallHighlight = Instance.new("Highlight", ball)
            BallHighlight.FillColor = Color3.fromRGB(255, 0, 0)
            BallHighlight.OutlineColor = Color3.fromRGB(255, 255, 0)
        end

        if not BallBillboard then
            BallBillboard = Instance.new("BillboardGui", ball)
            BallBillboard.Size = UDim2.new(0, 100, 0, 50)
            BallBillboard.StudsOffset = Vector3.new(0, 5, 0)
            local text = Instance.new("TextLabel", BallBillboard)
            text.Size = UDim2.new(1,0,1,0)
            text.BackgroundTransparency = 1
            text.Text = "DEATH BALL"
            text.TextColor3 = Color3.fromRGB(255, 0, 0)
            text.TextScaled = true
        end

        local dist = (ball.Position - Root.Position).Magnitude
        BallBillboard:FindFirstChild("TextLabel").Text = "BALL | " .. math.floor(dist) .. "m"
    else
        if BallHighlight then BallHighlight:Destroy(); BallHighlight = nil end
        if BallBillboard then BallBillboard:Destroy(); BallBillboard = nil end
    end
end)

-- === PLAYER ESP ===
local PlayerHighlights = {}
RunService.RenderStepped:Connect(function()
    if getgenv().PlayerESP then
        for _, plr in Players:GetPlayers() do
            if plr ~= LocalPlayer and plr.Character then
                if not PlayerHighlights[plr] then
                    local hl = Instance.new("Highlight", plr.Character)
                    hl.FillColor = Color3.fromRGB(255, 0, 0)
                    PlayerHighlights[plr] = hl
                end
            end
        end
    else
        for _, hl in pairs(PlayerHighlights) do hl:Destroy() end
        PlayerHighlights = {}
    end
end)

-- === SPEED + NOCLIP + INFINITE JUMP ===
RunService.Stepped:Connect(function()
    if Character and Humanoid then
        Humanoid.WalkSpeed = getgenv().SpeedHack and getgenv().WalkSpeed or 16
        for _, part in Character:GetDescendants() do
            if part:IsA("BasePart") and getgenv().NoClip then
                part.CanCollide = false
            end
        end
    end
end)

UserInputService.JumpRequest:Connect(function()
    if getgenv().InfiniteJump then
        Humanoid:ChangeState("Jumping")
    end
end)

-- === GUI ===
FarmTab:CreateToggle({Name = "Auto Farm", Callback = function(v) getgenv().AutoFarm = v end})
FarmTab:CreateToggle({Name = "Auto Claim Quest", Callback = function(v) getgenv().AutoClaimQuest = v end})

CombatTab:CreateToggle({Name = "Auto Parry", Callback = function(v) getgenv().AutoParry = v end})
CombatTab:CreateSlider({Name = "Parry Distance", Range = {10, 40}, Callback = function(v) getgenv().ParryDistance = v end})
CombatTab:CreateToggle({Name = "Auto Walk", Callback = function(v) getgenv().AutoWalk = v end})
CombatTab:CreateToggle({Name = "Auto Spam", Callback = function(v) getgenv().AutoSpam = v end})
CombatTab:CreateToggle({Name = "Auto Ability", Callback = function(v) getgenv().AutoAbility = v end})

VisualsTab:CreateToggle({Name = "Ball ESP", Callback = function(v) getgenv().BallESP = v end})
VisualsTab:CreateToggle({Name = "Player ESP", Callback = function(v) getgenv().PlayerESP = v end})

MiscTab:CreateToggle({Name = "Speed Hack", Callback = function(v) getgenv().SpeedHack = v end})
MiscTab:CreateSlider({Name = "Walk Speed", Range = {16, 300}, Callback = function(v) getgenv().WalkSpeed = v end})
MiscTab:CreateToggle({Name = "Infinite Jump", Callback = function(v) getgenv().InfiniteJump = v end})
MiscTab:CreateToggle({Name = "NoClip", Callback = function(v) getgenv().NoClip = v end})

Rayfield:Notify({Title = "ФИКС v9.9", Content = "ВСЁ РАБОТАЕТ! 2025 UPDATE", Duration = 6})
