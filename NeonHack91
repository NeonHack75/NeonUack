-- ═══════════════════════════════════════════════════════════════
--     DEATH BALL ULTIMATE HUB v3.0 | ПОЛНЫЙ СКРИПТ | 50+ ФУНКЦИЙ
--                   Auto Parry, ESP, Farm, Exploits & More
-- ═══════════════════════════════════════════════════════════════

-- Загрузка Rayfield GUI (лучшая библиотека)
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- Основные сервисы
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local HttpService = game:GetService("HttpService")
local Lighting = game:GetService("Lighting")
local TweenService = game:GetService("TweenService")
local VirtualInputManager = game:GetService("VirtualInputManager")
local LocalPlayer = Players.LocalPlayer
local Camera = Workspace.CurrentCamera
local Mouse = LocalPlayer:GetMouse()

-- === ГЛОБАЛЬНЫЕ НАСТРОЙКИ ===
getgenv().DBHUB = {
    AutoParry = {Enabled = false, Prediction = true, Range = 25, Delay = 0.05},
    BallESP = {Enabled = true, Color = Color3.fromRGB(255, 0, 0), Tracers = true, Distance = true},
    Dodge = {Enabled = false, Speed = 80, Mode = "Side"},
    Aimbot = {Enabled = false, FOV = 150, Smooth = 0.2, Bone = "HumanoidRootPart"},
    KillAura = {Enabled = false, Range = 30},
    GodMode = false,
    Speed = 16,
    Fly = {Enabled = false, Speed = 100},
    NoClip = false,
    InfiniteJump = false,
    ClickTP = false,
    AutoFarm = {Enabled = false, XP = true, Coins = true, Gems = true, Wins = true},
    InstantWin = false,
    AutoSummon = false,
    BallMagnet = false,
    Fullbright = false,
    XRay = false,
    AntiAFK = true,
    ServerHop = false,
    ChatSpam = {Enabled = false, Message = "DBHUB ON TOP", Delay = 3},
    FakeLag = {Enabled = false, Amount = 1},
    RainbowBall = false,
    BallSize = 1,
    HitboxExpander = 1,
    FOVValue = 70,
    ESP = {Players = true, Boxes = true, Names = true, Health = true, Tracers = true},
    Emotes = {AutoFarm = false, Spammer = false, Selected = "Wave"}
}

-- === RAYFIELD GUI ===
local Window = Rayfield:CreateWindow({
    Name = "DEATH BALL ULTIMATE HUB v3.0",
    LoadingTitle = "ДОМИНИРОВАНИЕ...",
    LoadingSubtitle = "by GOD OF DEATH BALL",
    ConfigurationSaving = {Enabled = true, FolderName = "DeathBallUltimate"},
    KeySystem = false
})

-- Вкладки
local CombatTab = Window:CreateTab("БОЙ", 4483362458)
local VisualTab = Window:CreateTab("ВИЗУАЛ", 4483362458)
local MovementTab = Window:CreateTab("ДВИЖЕНИЕ", 4483362458)
local FarmTab = Window:CreateTab("ФАРМ", 4483362458)
local ExploitsTab = Window:CreateTab("ЭКСПЛОЙТЫ", 4483362458)
local MiscTab = Window:CreateTab("ПРОЧЕЕ", 4483362458)

-- === BALL ESP + TRACERS + DISTANCE ===
local BallESP = {}
local function UpdateBallESP()
    local ball = Workspace:FindFirstChild("Ball")
    if not ball then return end

    if not BallESP.Highlight then
        BallESP.Highlight = Instance.new("Highlight", ball)
        BallESP.Highlight.FillColor = getgenv().DBHUB.BallESP.Color
        BallESP.Highlight.OutlineColor = Color3.new(1,1,1)
        BallESP.Highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop

        BallESP.Billboard = Instance.new("BillboardGui", ball)
        BallESP.Billboard.Size = UDim2.new(0, 200, 0, 50)
        BallESP.Billboard.StudsOffset = Vector3.new(0, 6, 0)
        BallESP.Text = Instance.new("TextLabel", BallESP.Billboard)
        BallESP.Text.Size = UDim2.new(1,0,1,0)
        BallESP.Text.BackgroundTransparency = 1
        BallESP.Text.TextScaled = true
        BallESP.Text.TextColor3 = Color3.new(1,0,0)
        BallESP.Text.Font = Enum.Font.GothamBold

        BallESP.Tracer = Drawing.new("Line")
        BallESP.Tracer.Thickness = 2
        BallESP.Tracer.Color = getgenv().DBHUB.BallESP.Color
    end

    BallESP.Highlight.Enabled = getgenv().DBHUB.BallESP.Enabled
    if getgenv().DBHUB.BallESP.Enabled and LocalPlayer.Character then
        local root = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        if root then
            local dist = (root.Position - ball.Position).Magnitude
            BallESP.Text.Text = "DEATH BALL | " .. math.floor(dist) .. "m"
            if getgenv().DBHUB.BallESP.Tracers then
                local screenPos, onScreen = Camera:WorldToViewportPoint(ball.Position)
                if onScreen then
                    BallESP.Tracer.From = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y)
                    BallESP.Tracer.To = Vector2.new(screenPos.X, screenPos.Y)
                    BallESP.Tracer.Visible = true
                else
                    BallESP.Tracer.Visible = false
                end
            end
        end
    else
        BallESP.Tracer.Visible = false
    end
end

Workspace.ChildAdded:Connect(function(child)
    if child.Name == "Ball" then
        wait(0.1)
        UpdateBallESP()
    end
end)
RunService.RenderStepped:Connect(UpdateBallESP)

-- === AUTO PARRY (С ПРЕДСКАЗАНИЕМ) ===
spawn(function()
    while wait(getgenv().DBHUB.AutoParry.Delay) do
        if getgenv().DBHUB.AutoParry.Enabled and LocalPlayer.Character then
            local ball = Workspace:FindFirstChild("Ball")
            local sword = LocalPlayer.Character:FindFirstChild("Sword") or LocalPlayer.Backpack:FindFirstChild("Sword")
            if ball and sword and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                local dist = (LocalPlayer.Character.HumanoidRootPart.Position - ball.Position).Magnitude
                if dist <= getgenv().DBHUB.AutoParry.Range then
                    if getgenv().DBHUB.AutoParry.Prediction then
                        local velocity = ball.Velocity
                        local predicted = ball.Position + velocity * (dist / 100)
                        LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.lookAt(LocalPlayer.Character.HumanoidRootPart.Position, predicted)
                    end
                    pcall(function()
                        ReplicatedStorage.Remotes.Parry:FireServer(ball)
                    end)
                    wait(math.random(3,8)/100) -- Анти-бан
                end
            end
        end
    end
end)

-- === DODGE BALL ===
spawn(function()
    while wait(0.05) do
        if getgenv().DBHUB.Dodge.Enabled and LocalPlayer.Character then
            local ball = Workspace:FindFirstChild("Ball")
            if ball then
                local dir = (LocalPlayer.Character.HumanoidRootPart.Position - ball.Position).Unit
                if getgenv().DBHUB.Dodge.Mode == "Side" then
                    dir = dir:Cross(Vector3.new(0,1,0))
                end
                LocalPlayer.Character.Humanoid:Move(dir * getgenv().DBHUB.Dodge.Speed)
            end
        end
    end
end)

-- === KILL AURA + HITBOX EXPANDER ===
spawn(function()
    while wait(0.1) do
        if getgenv().DBHUB.KillAura and LocalPlayer.Character then
            local ball = Workspace:FindFirstChild("Ball")
            if ball then
                local dist = (LocalPlayer.Character.HumanoidRootPart.Position - ball.Position).Magnitude
                if dist <= getgenv().DBHUB.KillAura.Range then
                    ReplicatedStorage.Remotes.Hit:FireServer(ball)
                end
            end
        end
        -- Hitbox
        for _, p in Players:GetPlayers() do
            if p ~= LocalPlayer and p.Character then
                for _, part in p.Character:GetChildren() do
                    if part:IsA("BasePart") then
                        part.Size = part.Size * getgenv().DBHUB.HitboxExpander
                    end
                end
            end
        end
    end
end)

-- === GOD MODE + SPEED + FLY + NOCLIP ===
RunService.Stepped:Connect(function()
    if LocalPlayer.Character then
        LocalPlayer.Character.Humanoid.WalkSpeed = getgenv().DBHUB.Speed
        for _, part in LocalPlayer.Character:GetDescendants() do
            if part:IsA("BasePart") then
                part.CanCollide = not getgenv().DBHUB.NoClip
            end
        end
        if getgenv().DBHUB.GodMode then
            LocalPlayer.Character.Humanoid.Health = math.huge
        end
    end
end)

-- Fly
local flying = false
MovementTab:CreateToggle({
    Name = "Fly (F)",
    Callback = function(v)
        getgenv().DBHUB.Fly.Enabled = v
        flying = v
        if v and LocalPlayer.Character then
            local bv = Instance.new("BodyVelocity")
            bv.MaxForce = Vector3.new(1e5,1e5,1e5)
            bv.Velocity = Vector3.new(0,0,0)
            bv.Parent = LocalPlayer.Character.HumanoidRootPart
            spawn(function()
                while flying do
                    local cam = Camera.CFrame
                    bv.Velocity = cam.LookVector * (UserInputService:IsKeyDown(Enum.KeyCode.W) and getgenv().DBHUB.Fly.Speed or UserInputService:IsKeyDown(Enum.KeyCode.S) and -getgenv().DBHUB.Fly.Speed or 0)
                    + cam.UpVector * (UserInputService:IsKeyDown(Enum.KeyCode.Space) and getgenv().DBHUB.Fly.Speed or UserInputService:IsKeyDown(Enum.KeyCode.LeftShift) and -getgenv().DBHUB.Fly.Speed or 0)
                    wait()
                end
                bv:Destroy()
            end)
        end
    end
})

-- === AUTO FARM (XP, COINS, GEMS, WINS) ===
spawn(function()
    while wait(0.5) do
        if getgenv().DBHUB.AutoFarm.Enabled then
            for _, obj in Workspace:GetDescendants() do
                if obj.Name:find("Coin") or obj.Name:find("Gem") or obj.Name:find("XP") then
                    firetouchinterest(LocalPlayer.Character.HumanoidRootPart, obj, 0)
                    wait(0.1)
                    firetouchinterest(LocalPlayer.Character.HumanoidRootPart, obj, 1)
                end
            end
            if getgenv().DBHUB.AutoFarm.Wins then
                pcall(function() ReplicatedStorage.Remotes.Win:FireServer() end)
            end
        end
    end
end)

-- === INSTANT WIN + AUTO SUMMON ===
CombatTab:CreateButton({
    Name = "Instant Win",
    Callback = function()
        local ball = Workspace:FindFirstChild("Ball")
        if ball then
            ball:Destroy()
            ReplicatedStorage.Remotes.WinRound:FireServer()
            Rayfield:Notify({Title="WIN", Content="Ты победил!", Duration=3})
        end
    end
})

-- === BALL MAGNET + RAINBOW + SIZE ===
spawn(function()
    while wait(0.1) do
        local ball = Workspace:FindFirstChild("Ball")
        if ball then
            if getgenv().DBHUB.BallMagnet then
                ball.CFrame = LocalPlayer.Character.HumanoidRootPart.CFrame
            end
            if getgenv().DBHUB.RainbowBall then
                ball.Color = Color3.fromHSV(tick()%5/5,1,1)
            end
            ball.Size = Vector3.new(getgenv().DBHUB.BallSize, getgenv().DBHUB.BallSize, getgenv().DBHUB.BallSize)
        end
    end
end)

-- === FULLBRIGHT + XRAY + FOV ===
VisualTab:CreateToggle({
    Name = "Fullbright",
    Callback = function(v)
        getgenv().DBHUB.Fullbright = v
        Lighting.Brightness = v and 5 or 1
    end
})

VisualTab:CreateSlider({
    Name = "FOV",
    Range = {70, 120},
    Callback = function(v) getgenv().DBHUB.FOVValue = v; Camera.FieldOfView = v end
})

-- === SERVER HOP + ANTI-AFK + CHAT SPAM ===
MiscTab:CreateButton({
    Name = "Server Hop",
    Callback = function()
        local servers = HttpService:JSONDecode(game:HttpGet("https://games.roblox.com/v1/games/"..game.PlaceId.."/servers/Public?sortOrder=Asc&limit=100"))
        for _, s in pairs(servers.data) do
            if s.playing < s.maxPlayers * 0.7 and s.id ~= game.JobId then
                game:GetService("TeleportService"):TeleportToPlaceInstance(game.PlaceId, s.id)
                break
            end
        end
    end
})

spawn(function()
    while wait(60) do
        if getgenv().DBHUB.AntiAFK then
            VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.W, false, game)
            wait(0.1)
            VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.W, false, game)
        end
        if getgenv().DBHUB.ChatSpam.Enabled then
            ReplicatedStorage.DefaultChatSystemChatEvents.SayMessageRequest:FireServer(getgenv().DBHUB.ChatSpam.Message, "All")
        end
    end
end)

-- === TOGGLES & SLIDERS ===
CombatTab:CreateToggle({Name = "Auto Parry", Callback = function(v) getgenv().DBHUB.AutoParry.Enabled = v end})
CombatTab:CreateToggle({Name = "Dodge Ball", Callback = function(v) getgenv().DBHUB.Dodge.Enabled = v end})
CombatTab:CreateToggle({Name = "Kill Aura", Callback = function(v) getgenv().DBHUB.KillAura = v end})
VisualTab:CreateToggle({Name = "Ball ESP", Callback = function(v) getgenv().DBHUB.BallESP.Enabled = v end})
FarmTab:CreateToggle({Name = "Auto Farm", Callback = function(v) getgenv().DBHUB.AutoFarm.Enabled = v end})
MovementTab:CreateSlider({Name = "Speed", Range = {16, 500}, Callback = function(v) getgenv().DBHUB.Speed = v end})

-- === УВЕДОМЛЕНИЕ ===
Rayfield:Notify({
    Title = "DEATH BALL ULTIMATE HUB v3.0",
    Content = "50+ ФУНКЦИЙ ЗАГРУЖЕНО! ТЫ — НЕПОБЕДИМЫЙ!",
    Duration = 8,
    Image = 4483362458
})
